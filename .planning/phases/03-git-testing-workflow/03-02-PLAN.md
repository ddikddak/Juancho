---
phase: 03-git-testing-workflow
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md
autonomous: true

must_haves:
  truths:
    - "verify-phase runs build command before determining phase status"
    - "verify-phase blocks phase transition when test suite fails"
    - "verify-phase includes browser testing checklist for web app projects"
    - "verify-phase detects project type to select correct build/test commands"
  artifacts:
    - path: "~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md"
      provides: "Build verification, test gate, and browser testing instructions"
      min_lines: 50
  key_links:
    - from: "verify-phase/SKILL.md"
      to: "npm run build"
      via: "Build verification instruction in verifier prompt"
      pattern: "npm run build\\|cargo build"
    - from: "verify-phase/SKILL.md"
      to: "test suite"
      via: "Test gate blocking phase transition"
      pattern: "test.*pass\\|test.*fail"
    - from: "verify-phase/SKILL.md"
      to: "browser"
      via: "Browser testing checklist for web apps"
      pattern: "browser.*test\\|Xvfb\\|Playwright"
---

<objective>
Enhance verify-phase skill with build verification, test suite gate, and browser testing checklist.

Purpose: verify-phase currently does 3-level artifact verification but lacks build verification (ensure project compiles), test suite enforcement (block transition if tests fail), and browser testing guidance for web app projects.

Output: Updated verify-phase/SKILL.md with build/test/browser behavioral instructions.
</objective>

<execution_context>
@/Users/didac/.claude/get-shit-done/workflows/execute-plan.md
@/Users/didac/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-git-testing-workflow/03-RESEARCH.md
@~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add build verification and test gate to verify-phase</name>
  <files>~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md</files>
  <action>
Edit ~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md to add three behavioral instruction blocks inside the gsd-verifier subagent prompt. Keep the file under 350 lines and 15k chars.

**1. Build Verification (add inside the verifier prompt, after `</anti_pattern_scan>` and before `<status_determination>`):**

Add a `<build_verification>` section:
- Detect project type from files: package.json -> `npm run build`, Cargo.toml -> `cargo build`, go.mod -> `go build ./...`, pyproject.toml/setup.py -> `python -m build`
- Run the build command
- If build fails: set status to gaps_found, add build failure to gaps list with full error output
- If no recognized build system: skip (log "No build system detected, skipping build verification")
- Build must pass BEFORE status determination

**2. Test Suite Gate (add inside the verifier prompt, after build verification):**

Add a `<test_suite_gate>` section:
- Detect test command: package.json scripts.test -> `npm test`, Cargo.toml -> `cargo test`, go.mod -> `go test ./...`, pytest.ini/conftest.py -> `pytest`
- Run the test command
- If tests fail: set status to gaps_found regardless of artifact verification results
- Phase transition BLOCKED until test suite passes
- Include test output in VERIFICATION.md
- Rule: "Test failures are BLOCKERS, not warnings"

**3. Browser Testing Checklist (add inside the verifier prompt, after test suite gate):**

Add a `<browser_testing>` section:
- Only applies to web app projects (detected by: package.json with react/next/vue/svelte/angular, or index.html in src/)
- Checklist items: start dev server, navigate to localhost, verify page loads, check for console errors, test key interactions
- On VPS: note Xvfb environment (DISPLAY=:1) for headed browser via Playwright
- This is a human_needed verification item (added to VERIFICATION.md human verification section)
- If not a web app project: skip entirely

**Token efficiency:** Concise behavioral rules. Terse detection logic. No verbose explanations.
  </action>
  <verify>
wc -l ~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md
wc -c ~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md
grep "npm run build\|cargo build" ~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md
grep -i "test.*gate\|test.*block\|test.*fail" ~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md
grep -i "browser\|Xvfb\|Playwright" ~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md
  </verify>
  <done>
- verify-phase/SKILL.md contains build verification with project type detection
- verify-phase/SKILL.md contains test suite gate that blocks phase transition on failure
- verify-phase/SKILL.md contains browser testing checklist for web app projects
- File is under 350 lines and 15k chars
  </done>
</task>

</tasks>

<verification>
1. `wc -l ~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md` -- under 350 lines
2. `wc -c ~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md` -- under 15000 chars
3. `grep -c "build\|test.*gate\|browser" ~/.openclaw/workspace-juancho/skills/verify-phase/SKILL.md` -- returns 3+
4. File still parses as valid markdown with YAML frontmatter
</verification>

<success_criteria>
- Build verification with auto-detected build command present in verifier prompt
- Test suite gate blocks phase transition when tests fail
- Browser testing checklist present for web app projects
- File within size limits (350 lines, 15k chars)
</success_criteria>

<output>
After completion, create `.planning/phases/03-git-testing-workflow/03-02-SUMMARY.md`
</output>
