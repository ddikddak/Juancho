---
phase: 03-git-testing-workflow
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.openclaw/workspace-juancho/skills/plan-phase/SKILL.md
  - ~/.openclaw/workspace-juancho/AGENTS.md
autonomous: true

must_haves:
  truths:
    - "plan-phase includes test commands in task verify section examples"
    - "plan-phase detects project type for appropriate test/build commands"
    - "AGENTS.md references test-first discipline as core workflow step"
    - "AGENTS.md references browser testing for web app verification"
  artifacts:
    - path: "~/.openclaw/workspace-juancho/skills/plan-phase/SKILL.md"
      provides: "Test command templates and project type detection in planning"
      min_lines: 50
    - path: "~/.openclaw/workspace-juancho/AGENTS.md"
      provides: "Test-first discipline and browser testing references"
      min_lines: 30
  key_links:
    - from: "plan-phase/SKILL.md"
      to: "npm test"
      via: "Test command in verify section template"
      pattern: "npm test\\|cargo test\\|pytest"
    - from: "AGENTS.md"
      to: "test-first"
      via: "Test discipline section"
      pattern: "test.*first\\|test.*before"
    - from: "AGENTS.md"
      to: "browser"
      via: "Browser testing reference"
      pattern: "browser\\|headless\\|Xvfb"
---

<objective>
Enhance plan-phase templates with test command requirements and update AGENTS.md with test-first discipline and browser testing references.

Purpose: plan-phase currently creates tasks but doesn't require test commands in `<verify>` sections. AGENTS.md mentions testing but lacks explicit test-first discipline rules and browser testing guidance. These cross-cutting updates ensure every generated plan includes testing, and the engineering discipline document codifies the test-first and browser testing workflow.

Output: Updated plan-phase/SKILL.md and AGENTS.md with test and browser behavioral instructions.
</objective>

<execution_context>
@/Users/didac/.claude/get-shit-done/workflows/execute-plan.md
@/Users/didac/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-git-testing-workflow/03-RESEARCH.md
@~/.openclaw/workspace-juancho/skills/plan-phase/SKILL.md
@~/.openclaw/workspace-juancho/AGENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add test command requirements to plan-phase templates</name>
  <files>~/.openclaw/workspace-juancho/skills/plan-phase/SKILL.md</files>
  <action>
Edit ~/.openclaw/workspace-juancho/skills/plan-phase/SKILL.md to add test command requirements. Keep under 350 lines and 15k chars.

**1. Project Type Detection (add inside the planner subagent prompt, inside `<task_design_principles>`):**

Add a concise project type detection heuristic:
- package.json -> Node/TS: test=`npm test`, build=`npm run build`
- Cargo.toml -> Rust: test=`cargo test`, build=`cargo build`
- go.mod -> Go: test=`go test ./...`, build=`go build ./...`
- pyproject.toml/setup.py -> Python: test=`pytest`, build=`python -m build`
- If unknown: include placeholder `# TODO: add project-specific test command`

**2. Test Command in Verify Section (modify the Task Structure XML example in `<plan_structure>`):**

Update the `<verify>` section example to always include a test command. Change from:
```xml
<verify>
ls path/to/file
grep "pattern" path/to/file
npm test
</verify>
```

To make it explicit that test command is REQUIRED, not optional:
```xml
<verify>
ls path/to/file
grep "pattern" path/to/file
{project_test_command}  # REQUIRED: test command must always be present
</verify>
```

**3. Add Verify Section Rule (add inside `<task_design_principles>`):**

Add a concise rule: "Every task `<verify>` section MUST include the project's test command. Tasks without test verification will be rejected by execute-phase."

**Token efficiency:** Minimal additions. Modify existing examples rather than adding new sections where possible.
  </action>
  <verify>
wc -l ~/.openclaw/workspace-juancho/skills/plan-phase/SKILL.md
wc -c ~/.openclaw/workspace-juancho/skills/plan-phase/SKILL.md
grep -i "test command\|npm test\|cargo test\|pytest" ~/.openclaw/workspace-juancho/skills/plan-phase/SKILL.md
grep -i "REQUIRED\|must include" ~/.openclaw/workspace-juancho/skills/plan-phase/SKILL.md
  </verify>
  <done>
- plan-phase/SKILL.md has project type detection heuristic for test/build commands
- plan-phase/SKILL.md verify section example explicitly requires test command
- plan-phase/SKILL.md has rule that every verify section must include test command
- File is under 350 lines and 15k chars
  </done>
</task>

<task type="auto">
  <name>Task 2: Add test-first discipline and browser testing to AGENTS.md</name>
  <files>~/.openclaw/workspace-juancho/AGENTS.md</files>
  <action>
Edit ~/.openclaw/workspace-juancho/AGENTS.md to add test-first discipline and browser testing references. Keep under 350 lines and 15k chars.

**1. Enhance "Development Workflow" section:**

Update the existing Build and Test bullet points to emphasize test-first discipline:
- Build: "Tests first (TDD when applicable). Run test suite after EVERY code change. Never commit without passing tests."
- Test: "Full suite before committing. Build must succeed. Verify UI/behavior via browser for web apps."

**2. Add "Test-First Discipline" subsection (after "Git Discipline"):**

Concise rules:
- Run tests after every code change, not just at end
- Test failures are blockers, never warnings
- Never suppress error output
- Debug failures before retrying
- Build verification required before phase transition
- Phase transitions blocked until test suite passes

**3. Add "Browser Testing" subsection (after "Test-First Discipline"):**

Concise rules:
- Web app projects require browser verification
- Use Playwright via OpenClaw's browser tool
- On VPS: Xvfb provides virtual display (DISPLAY=:1)
- Verify: page loads, navigation works, forms submit, no console errors
- Browser testing is human_needed verification (present checklist)

**4. Update "Git Discipline" section:**

Add to existing section:
- Feature branches per phase: `feat/phase-{XX}-{slug}`
- PR created via `gh pr create` after phase completion
- Squash merge to main

**Token efficiency:** Terse rules. No verbose paragraphs. Bullet points only.
  </action>
  <verify>
wc -l ~/.openclaw/workspace-juancho/AGENTS.md
wc -c ~/.openclaw/workspace-juancho/AGENTS.md
grep -i "test-first\|test.*first" ~/.openclaw/workspace-juancho/AGENTS.md
grep -i "browser.*test\|Xvfb\|Playwright" ~/.openclaw/workspace-juancho/AGENTS.md
grep "feat/phase" ~/.openclaw/workspace-juancho/AGENTS.md
  </verify>
  <done>
- AGENTS.md has test-first discipline section with clear rules
- AGENTS.md has browser testing section referencing Playwright and Xvfb
- AGENTS.md git discipline section includes feature branch and PR creation
- File is under 350 lines and 15k chars
  </done>
</task>

</tasks>

<verification>
1. `wc -l ~/.openclaw/workspace-juancho/skills/plan-phase/SKILL.md` -- under 350 lines
2. `wc -c ~/.openclaw/workspace-juancho/skills/plan-phase/SKILL.md` -- under 15000 chars
3. `wc -l ~/.openclaw/workspace-juancho/AGENTS.md` -- under 350 lines
4. `wc -c ~/.openclaw/workspace-juancho/AGENTS.md` -- under 15000 chars
5. All four target files updated with test/git/browser behavioral instructions
</verification>

<success_criteria>
- plan-phase templates require test commands in verify sections
- AGENTS.md codifies test-first discipline and browser testing as engineering requirements
- AGENTS.md git discipline includes feature branches and PR creation
- All files within size limits (350 lines, 15k chars)
</success_criteria>

<output>
After completion, create `.planning/phases/03-git-testing-workflow/03-03-SUMMARY.md`
</output>
