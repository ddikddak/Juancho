---
phase: 03-git-testing-workflow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md
autonomous: true

must_haves:
  truths:
    - "execute-phase creates feature branch before first plan if on main"
    - "execute-phase pushes branch and creates PR via gh CLI after phase completion"
    - "execute-phase blocks commits when verification commands fail"
    - "execute-phase surfaces test failures with full error output for debugging"
  artifacts:
    - path: "~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md"
      provides: "Git branching, PR creation, and test enforcement instructions"
      min_lines: 50
  key_links:
    - from: "execute-phase/SKILL.md"
      to: "git checkout -b"
      via: "Feature branch creation instruction in workflow"
      pattern: "git checkout -b"
    - from: "execute-phase/SKILL.md"
      to: "gh pr create"
      via: "PR creation instruction in step 11"
      pattern: "gh pr create"
    - from: "execute-phase/SKILL.md"
      to: "NEVER commit without passing"
      via: "Test enforcement gate in task execution protocol"
      pattern: "NEVER commit"
---

<objective>
Enhance execute-phase skill with feature branching, PR creation, and test enforcement gate.

Purpose: execute-phase currently commits per-task with conventional format but lacks feature branch lifecycle (create before first plan, PR after phase), and has no explicit test enforcement gate that blocks commits when tests fail.

Output: Updated execute-phase/SKILL.md with branching, PR, and test gate behavioral instructions.
</objective>

<execution_context>
@/Users/didac/.claude/get-shit-done/workflows/execute-plan.md
@/Users/didac/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-git-testing-workflow/03-RESEARCH.md
@~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add feature branch creation and test enforcement to execute-phase</name>
  <files>~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md</files>
  <action>
Edit ~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md to add three behavioral instruction blocks. Keep the file under 350 lines and 15k chars.

**1. Feature Branch Creation (add between step 5 "Group Plans by Wave" and step 6 "Execute Waves Sequentially"):**

Add a new step "5.5. Ensure Feature Branch" with these instructions:
- Before executing any plans, check current branch: `git rev-parse --abbrev-ref HEAD`
- If on main/master, create feature branch: `git checkout -b feat/phase-{XX}-{slug}`
- Branch naming: feat/ for features, fix/ for fixes, chore/ for tooling
- The {slug} comes from the phase directory name (e.g., "git-testing-workflow")
- If already on a feature branch (from resumed execution), stay on it
- Report branch name to user

**2. Test Enforcement Gate (modify the task execution protocol in step 6.2):**

In the `<task_execution_protocol>` section inside the subagent prompt, between step 2 "Run verification commands" and step 3 "Confirm done criteria met", add explicit test enforcement:
- After running verification commands, check if ANY failed
- If verification fails: surface FULL error output, do NOT proceed to commit
- Debug the failure: read error, identify root cause, fix the code
- Re-run verification until ALL pass
- Add explicit rule: "NEVER commit with failing tests. NEVER suppress errors."
- Only proceed to commit after ALL verification commands pass

**3. PR Creation (modify step 11 "Git Commit Phase Completion"):**

After the existing git commit in step 11, add PR creation instructions:
- Push feature branch: `git push -u origin {branch_name}`
- Create PR via gh CLI: `gh pr create --title "Phase {X}: {Name}" --body "..."`
- PR body should summarize: phase goal, plans completed, verification status
- Use heredoc for multi-line PR body
- Include PR URL in the phase completion report to user
- If `gh` auth fails, create authentication gate checkpoint (don't fail the phase)

**Token efficiency:** Use concise markdown. No verbose explanations. Behavioral instructions should be terse command sequences with clear rules.
  </action>
  <verify>
wc -l ~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md
wc -c ~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md
grep "git checkout -b" ~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md
grep "gh pr create" ~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md
grep "NEVER commit" ~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md
  </verify>
  <done>
- execute-phase/SKILL.md contains feature branch creation before wave execution
- execute-phase/SKILL.md contains PR creation via gh CLI after phase completion
- execute-phase/SKILL.md contains test enforcement gate that blocks commits on failure
- File is under 350 lines and 15k chars
  </done>
</task>

</tasks>

<verification>
1. `wc -l ~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md` -- under 350 lines
2. `wc -c ~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md` -- under 15000 chars
3. `grep -c "git checkout -b\|gh pr create\|NEVER commit" ~/.openclaw/workspace-juancho/skills/execute-phase/SKILL.md` -- returns 3+
4. File still parses as valid markdown with YAML frontmatter
</verification>

<success_criteria>
- Feature branch creation instructions present and correctly placed in workflow
- PR creation with gh CLI present in step 11
- Test enforcement gate blocks commits when verification fails
- File within size limits (350 lines, 15k chars)
</success_criteria>

<output>
After completion, create `.planning/phases/03-git-testing-workflow/03-01-SUMMARY.md`
</output>
