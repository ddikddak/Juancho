---
phase: 04-proactive-autonomy-ux
plan: 04
type: execute
wave: 2
depends_on: ["04-01", "04-02", "04-03"]
files_modified:
  - ~/.openclaw/workspace-juancho/AGENTS.md
autonomous: false

must_haves:
  truths:
    - "AGENTS.md references all new skills and heartbeat configuration"
    - "Telegram message chunking works for long outputs (inherited from OpenClaw)"
    - "File upload works for very large content (inherited from OpenClaw)"
    - "Inline keyboards display action buttons in Telegram messages (inherited from OpenClaw)"
    - "Multi-provider AI support works (inherited from OpenClaw)"
    - "VPS deployment with headless browser works (inherited from OpenClaw)"
    - "Upstream sync capability maintained (no src/ changes)"
  artifacts:
    - path: "~/.openclaw/workspace-juancho/AGENTS.md"
      provides: "Updated agent instructions referencing all Phase 4 capabilities"
      contains: "heartbeat"
  key_links:
    - from: "~/.openclaw/workspace-juancho/AGENTS.md"
      to: "skills/telegram-*/SKILL.md"
      via: "References Telegram commands in command list"
      pattern: "/status|/commit|/test|/phase|/research"
    - from: "~/.openclaw/workspace-juancho/AGENTS.md"
      to: "heartbeat.md"
      via: "References heartbeat for proactive behavior"
      pattern: "heartbeat|proactive"
---

<objective>
Update AGENTS.md with Phase 4 capabilities (heartbeat, Telegram commands, onboarding, documentation, work logs) and verify that inherited OpenClaw infrastructure works correctly (Telegram UX features, multi-provider AI, VPS deployment, upstream sync).

Purpose: AGENTS.md is the central reference for Juancho's capabilities. It must reflect all Phase 4 additions. Infrastructure verification confirms that inherited features (message chunking, file upload, inline keyboards, multi-provider, VPS, upstream sync) work without modification.
Output: Updated AGENTS.md + infrastructure verification results
</objective>

<execution_context>
@/Users/didac/.claude/get-shit-done/workflows/execute-plan.md
@/Users/didac/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/didac/Juancho/.planning/PROJECT.md
@/Users/didac/Juancho/.planning/ROADMAP.md
@/Users/didac/Juancho/.planning/STATE.md
@/Users/didac/.openclaw/workspace-juancho/AGENTS.md
@/Users/didac/Juancho/.planning/phases/04-proactive-autonomy-ux/04-01-SUMMARY.md
@/Users/didac/Juancho/.planning/phases/04-proactive-autonomy-ux/04-02-SUMMARY.md
@/Users/didac/Juancho/.planning/phases/04-proactive-autonomy-ux/04-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update AGENTS.md with Phase 4 capabilities and verify infrastructure</name>
  <files>~/.openclaw/workspace-juancho/AGENTS.md</files>
  <action>
Read current AGENTS.md (129 lines). Add sections for Phase 4 capabilities while preserving all existing content.

**Add/update these sections:**

1. **Proactive Autonomy** section:
   - Heartbeat runs every 5 minutes during active hours
   - Reads STATE.md, determines next action automatically
   - Transitions between phases when tests pass
   - Reports blockers via Telegram, suggests alternatives
   - Uses HEARTBEAT_OK token when idle

2. **Telegram Commands** section (update existing command list if present, or add new):
   - /status -- Show current project status with action buttons
   - /commit -- Create git commit with staged changes
   - /test -- Run project test suite
   - /phase N -- Execute or check specific phase
   - /research TOPIC -- Research a domain or topic
   - All commands support inline keyboards for interactive follow-up

3. **Onboarding** section:
   - /onboard -- Developer setup flow (git, repo, AI provider, Telegram, first project)
   - Wraps /new-project for project definition

4. **Documentation & Logging** section:
   - Work logs generated after each plan (decisions, tradeoffs, issues)
   - Code documentation generated during phase verification (README, API docs)
   - Documentation generation has timeout protection

5. **Infrastructure** section (verification notes):
   - Telegram message chunking: handled by OpenClaw draft-chunking.ts (4096 char limit)
   - File upload: large content sent via sendDocument automatically
   - Inline keyboards: buildInlineKeyboard helper for interactive buttons
   - Multi-provider AI: Claude, OpenAI, Gemini, Ollama supported via OpenClaw
   - VPS deployment: headless browser via Xvfb + Puppeteer/Stagehand
   - Upstream sync: all customization in workspace files, zero src/ changes

Key constraints:
- Preserve ALL existing content in AGENTS.md
- Keep total under 350 lines / 15k chars (currently 129 lines, adding ~80 lines = ~209 lines)
- Reference skill paths, don't duplicate skill content
- Mark infrastructure items as "inherited from OpenClaw"

**Infrastructure verification steps** (run as part of this task):

1. **Telegram chunking** (INFR-01): Verify OpenClaw's draft-chunking.ts exists and handles the 4096 char limit
   - Check: grep for "4096" or "chunk" in OpenClaw src/telegram/ or src/draft/
   - Expected: File exists with chunking logic

2. **File upload** (INFR-02): Verify OpenClaw supports sendDocument
   - Check: grep for "sendDocument" or "InputFile" in OpenClaw src/telegram/
   - Expected: File upload capability exists

3. **Inline keyboards** (INFR-03): Verify buildInlineKeyboard exists
   - Check: grep for "buildInlineKeyboard" in OpenClaw src/telegram/
   - Expected: Helper function exists

4. **Multi-provider AI** (INFR-04): Verify multiple providers configured
   - Check: grep for "anthropic\|openai\|gemini\|ollama" in OpenClaw src/ai/ or src/config/
   - Expected: Multiple providers supported

5. **VPS + headless browser**: Verify Stagehand/Puppeteer integration
   - Check: grep for "puppeteer\|stagehand\|xvfb" in OpenClaw src/ or package.json
   - Expected: Browser automation exists

6. **Upstream sync**: Verify zero src/ modifications
   - Check: git diff upstream/main --stat -- src/ (or check no src/ files in Juancho commits)
   - Expected: No src/ modifications

Document verification results in AGENTS.md infrastructure section with pass/fail status.
  </action>
  <verify>
1. AGENTS.md contains "Proactive Autonomy" or "heartbeat" section
2. AGENTS.md lists all 5 Telegram commands (/status, /commit, /test, /phase, /research)
3. AGENTS.md references /onboard command
4. AGENTS.md references work logs and documentation generation
5. AGENTS.md has infrastructure verification section
6. AGENTS.md total lines under 350: wc -l
7. AGENTS.md total chars under 15000: wc -c
8. Infrastructure verification results documented
  </verify>
  <done>AGENTS.md updated with all Phase 4 capabilities. Infrastructure verified: Telegram chunking, file upload, inline keyboards, multi-provider AI, VPS deployment, upstream sync all confirmed working via OpenClaw inheritance.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 4 implementation:
- Heartbeat configuration for proactive autonomous execution (openclaw.json + heartbeat.md)
- 5 Telegram command skills (/status, /commit, /test, /phase, /research)
- Developer onboarding flow (/onboard)
- Work log generation in execute-phase
- Documentation generation in verify-phase
- Updated AGENTS.md with all capabilities
- Infrastructure verification (Telegram UX, multi-provider, VPS, upstream sync)
  </what-built>
  <how-to-verify>
1. Review heartbeat.md: does the decision tree make sense? Should any behaviors be different?
2. Check openclaw.json: are the heartbeat settings (5 min, 08:00-18:00, Europe/Madrid) correct for your usage?
3. Skim the 5 Telegram command skills: do the commands and button layouts match your expectations?
4. Review onboarding flow: does it cover the setup steps you'd want for a new installation?
5. Check work log template: are there sections you'd add or remove?
6. Verify AGENTS.md reflects the complete Juancho capability set

Run: `ls ~/.openclaw/workspace-juancho/skills/` -- should show all new skill directories
Run: `cat ~/.openclaw/openclaw.json | python3 -m json.tool` -- should show valid JSON with heartbeat config
Run: `wc -l ~/.openclaw/workspace-juancho/skills/*/SKILL.md` -- all files should be under 350 lines
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to address</resume-signal>
</task>

</tasks>

<verification>
1. AGENTS.md references all Phase 4 skills and capabilities
2. Infrastructure verification confirms inherited features work
3. All files within size limits
4. Human verified the complete Phase 4 implementation
</verification>

<success_criteria>
- AGENTS.md is the complete reference for Juancho's capabilities including Phase 4
- Infrastructure verification passed for all 4 INFR requirements
- Upstream sync confirmed (zero src/ changes)
- Human approved the complete Phase 4 implementation
</success_criteria>

<output>
After completion, create `.planning/phases/04-proactive-autonomy-ux/04-04-SUMMARY.md`
</output>
